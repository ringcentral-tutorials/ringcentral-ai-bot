<!DOCTYPE html><html><head><title>Building a RingCentral AI Chatbot- RingCentral Developer Tutorials</title><style>body, html {
  height:100%;
  width:100%;
  padding:0;
  margin:0;
  overflow:hidden;
  background-color:#ddd;
}
.wrapper {
  height:100%;
  width:100%;
}</style><link rel="shortcut icon" href="https://developers.ringcentral.com/assets/images/favicon.ico?v=20161209-1544"><link rel="apple-touch-icon" href="https://developers.ringcentral.com/assets/images/favicon.ico?v=20161209-1544"><link rel="apple-touch-icon" sizes="72x72" href="https://developers.ringcentral.com/assets/images/favicon.ico?v=20161209-1544"><link rel="apple-touch-icon" sizes="114x114" href="https://developers.ringcentral.com/assets/images/favicon.ico?v=20161209-1544"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/jquery-ui@1.12.1/themes/base/all.css"><link rel="stylesheet" href="viewsaurus.css"></head><body><div class="wrapper"><div class="dpw-header-container"><div class="dpw-header center-section"><div class="logo"><a href="https://developers.ringcentral.com" class="logo-link"></a></div><div class="nav-top-menus"></div><div class="dpw-login-section"><a href="https://developer.ringcentral.com/login.html#/">Sign in | Sign up</a></div></div></div><div id="viewsaurus" data-title="Building a RingCentral AI Chatbot"><div class="saurus-panes"><div class="saurus-panes-header"><a href="https://ringcentral.github.io/tutorials/" class="saurus-back-to-tutorials">Tutorials</a><span>&gt;</span><span>Building a RingCentral AI Chatbot</span></div><div class="saurus-prose"><div class="saurus-nav-buttons"><div class="saurus-nav-button nav-overview"><div class="saurus-nav-button-inner"><i class="fa fa-fw icon-menu"></i></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-previous"><div class="saurus-nav-button-inner"><a href=""> <i class="fa fa-fw fa-play fa-rotate-180"></i></a></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-next clickable"><div class="saurus-nav-button-inner"><a href="#1"> <i class="fa fa-fw fa-play"></i></a></div></div><div class="saurus-next-title"><span class="next-title-inner"></span></div></div><div class="saurus-progress-bar"></div><div class="saurus-start"><p>Welcome to RingCentral AI Chatbot tutorial! This tutorial will guide you through building a complete, public chatbot including user auth to third party services, subscribing to notifications, processing events and posting messages.

Click the &quot;Start&quot; button below to see how Viewsaurus works.</p><a href="#0">Start Tutorial</a></div><div class="saurus-content"><div data-title="RingCentral AI Bot" class="chapter"><div data-title="Overview" data-file="../README.md" data-highlight="1-6" class="step"><h2 id="overview">Overview</h2>
<ol>
<li>Prepare the development env</li>
<li>Test the bot</li>
<li>The bot workflow<ol>
<li>Bot auth</li>
<li>Subscribing for bot Events</li>
<li>Bot webhook get subscribed info</li>
<li>Bot post message</li>
<li>Build the user authorize URL</li>
<li>Use authrize</li>
<li>Subscribing for user voicemail events</li>
<li>User webhook</li>
<li>Process the voicemail</li>
</ol>
</li>
<li>Practice<ol>
<li>Support unmonitor command</li>
<li>Write a custom command support</li>
<li>Just tell chat group how many new voicemail there</li>
<li>Write custom voicemail reponse</li>
</ol>
</li>
</ol>
</div><div data-title="Prerequisites" data-file="../README.md" data-highlight="8-35" class="step"><h2 id="prepare-the-development-env">Prepare the development env</h2>
<p>Follow the readme&#39;s instruction, create required App, set proper env, get the development env ready, add the bot to glip, ready to test the bot.</p>
<ul>
<li>1.Node.js &gt;= 8.10</li>
<li>2.Create a bot app in <a href="https://developers.ringcentral.com">RingCentral developer site</a>, with permissions: <code>ReadContacts ReadMessages ReadPresence Contacts ReadAccounts SMS InternalMessages ReadCallLog ReadCallRecording SubscriptionWebhook Glip</code></li>
<li><p>3.Create a browser based app in RingCentral developer site, with all permissions.</p>
</li>
<li><p>4.Prepare the development env</p>
</li>
</ul>
<pre><code>git clone git@github.com:ringcentral-tutorials/ringcentral-ai-bot.git
# or git clone https://github.com/ringcentral-tutorials/ringcentral-ai-bot.git
cd ringcentral-ai-bot
yarn

# create config
cp .sample.env .env
# then edit .env, fill ringcentral app configs

## start local server
yarn dev

## start a ngrok proxy to local port
yarn proxy
# https://xxxxxx.ngrok.io ---&gt; http://localhost:7867
# you can check ngrok status from http://localhost:4040
</code></pre><ul>
<li>5.After started the ngrok server, you can set your ringcentral app&#39;s redirect URL to lamda&#39;s api gateway url, <code>https://xxxxxx.ngrok.io/bot-oauth</code> for bot app, <code>https://xxxxxx.ngrok.io/user-oauth</code> for user app, ngrok will proxy the request to your local server.</li>
<li>6.Goto your ringcentral developer site, in bot app&#39;s bot page, click <code>Add to glip</code>, Then bot Added, time to test it.</li>
</ul>
</div><div data-title="Test the bot" data-file="../README.md" data-highlight="37-38" class="step"><h2 id="test-the-bot">Test the bot</h2>
<p>Login to <a href="https://glip-app.devtest.ringcentral.com">https://glip-app.devtest.ringcentral.com</a>, click bot&#39;s name from people list to start the chat, just follow the bot&#39;s instructions. It works, then we can see how it works.</p>
</div><div data-title="Bot auth" data-file="../src/lamda/lib/bot-oauth.js" data-highlight="10-13" class="step"><h2 id="bot-authentication">Bot Authentication</h2>
<p>Since we set the redirect URL in bot app&#39;s setting page, when click the <code>Add to glip</code> Button, ringcentral will send request to the redirect URL, proxyed by ngrok, finallly get to our local server.</p>
<p>We will use the code(<code>event.queryStringParameters.code</code>) provided by the request to do authorize, and store the fetched accessToken/user id etc to database.</p>
<p>Then we can subscribe to glip post and group event, so when use add bot to chat group, or post message in chat group, ringcentral will send info to subscribed webhook.</p>
</div><div data-title="Subscribing for bot Events" data-file="../src/lamda/lib/store.js" data-highlight="95-119" class="step"><h2 id="subscribing-for-bot-events">Subscribing for bot Events</h2>
<p>The bot accesstoken will never expires, we set subscibe expire to a very long time(500000000ms, 15year+), set webhook to <code>/bot-webhook</code> so we can get data when use add bot to chat group, or post message in chat group.</p>
<p>Event filters are like this:</p>
<pre><code class="cm-s-monokai lang-js"><span class="cm-keyword">const</span> <span class="cm-variable">botEventFilters</span> <span class="cm-operator">=</span> () <span class="cm-operator">=&gt;</span> [
  <span class="cm-string">&#39;/restapi/v1.0/glip/posts&#39;</span>,
  <span class="cm-string">&#39;/restapi/v1.0/glip/groups&#39;</span>
]
</code></pre>
</div><div data-title="Bot webhook get subscribed info" data-file="../src/lamda/lib/bot-webhook.js" data-highlight="31-51" class="step"><h2 id="bot-webhook-get-subscribed-info">Bot webhook get subscribed info</h2>
<p>After the subscribe, when use add bot to chat group, or post message in chat group, now our <code>/bot-webhook</code> will get the subscribed info, so we can respond accordingly, like post some message to guide user.</p>
</div><div data-title="Bot post message" data-file="../src/lamda/lib/store.js" data-highlight="144-149" class="step"><h2 id="bot-post-message">Bot post message</h2>
<p>To create a post use the Glip Create Post API:</p>
<p><code>/restapi/v1.0/glip/groups/{groupId}/posts</code></p>
<p>This requires sending the bot access token in the <code>Authorization</code> header as the <code>Bearer</code> token value.</p>
<p>The bot automatically handles both creating a new post and authorization.</p>
<p>More information on the API is available here:</p>
<ul>
<li><a href="https://developer.ringcentral.com/api-reference#Posts-createGlipGroupPost">Create Post API</a></li>
</ul>
</div><div data-title="Build the user authorize URL" data-file="../src/lamda/lib/store.js" data-highlight="192-197" class="step"><h2 id="build-the-user-authorize-url">Build the user authorize URL</h2>
<p>After bot got joined chat group message, and guide user to <code>@</code> the bot, and command the bot by <code>@{BOTID} monitor</code>, bot now need send the user authorize URL, let user to do the OAuth authorization, that is why we need the user app in the beginning, bot could not get user info directly by design.</p>
</div><div data-title="Use authrize" data-file="../src/lamda/lib/user-oauth.js" data-highlight="9-21" class="step"><h2 id="use-authrize">Use authrize</h2>
<p>When user click the authorize URL, and successfully authorized, OAuth flow will visit our server&#39;s <code>/user-oauth</code> with authrization code.</p>
<p>Similar to bot auth process, just use the auth code get access token, store user info, group info and token to database. The difference is user access token expire. We will see how to deal with this later.</p>
<p>With user&#39;s authorization, we can subscribe to user&#39;s voicemail message, so when new voicemail comes, ringcentral server notify our bot server.</p>
</div><div data-title="Subscribing for user voicemail events" data-file="../src/lamda/lib/store.js" data-highlight="248-261" class="step"><h2 id="subscribing-for-user-voicemail-events">Subscribing for user voicemail events</h2>
<p>For user we subscribe these:</p>
<pre><code>[
  &#39;/restapi/v1.0/account/~/extension/~/message-store&#39;,
  &#39;/restapi/v1.0/subscription/~?threshold=59&amp;interval=15&#39;
]
</code></pre><p>1.Subscribe <code>message-store</code> to get new voicemail notification.</p>
<p>2.Subscribe to <code>&#39;/restapi/v1.0/subscription/~?threshold=59&amp;interval=15&#39;</code> will setup a reminder, 59 seconds before subscribe expires, send notication request to supplied webhook url(<code>/user-webhook</code> in our case), if not susccessful, resend every 15 senconds, so we do token renew and subsribe renew when we got these notification request to make user token auto renew.</p>
<p>You can read more about reminder hook from <a href="https://github.com/ringcentral/ringcentral-api-docs/blob/master/docs/notifications_webhooks.md">https://github.com/ringcentral/ringcentral-api-docs/blob/master/docs/notifications_webhooks.md</a></p>
</div><div data-title="User webhook" data-file="../src/lamda/lib/user-webhook.js" data-highlight="10-47" class="step"><h2 id="user-webhook">User webhook</h2>
<p>Since we subscribe user voicemail events and reminder event, we must handle then accordingly.</p>
<p>That is where we could do different bot operations. We can practice later.</p>
</div></div><div data-title="Process the voicemail" data-file="../src/lamda/lib/voicemail-process.js" data-highlight="37-62" class="step"><h2 id="process-the-voicemail">Process the voicemail</h2>
<p>When you receive the new voicemail event, process the voicemail by transcribing it to text and then analyzing the text.</p>
<p>Since it is a external service, we put it in a seprate module: <a href="https://github.com/zxdong262/audio-analysis-service">https://github.com/zxdong262/audio-analysis-service</a></p>
<p>You may noticed by default we get a fake result for demo, if you want to use real google service to handle it, you should follow the instruction in <a href="https://github.com/ringcentral-tutorials/ringcentral-ai-bot#build-and-run-in-production-env">README#Build and Run in production env</a> to set your <code>GOOGLE_APPLICATION_CREDENTIALS</code> in <code>.env</code> then you will get real result.</p>
<p>That is the whole process. Hope you know how it works now. If so, let&#39;s do some practice, write some code.</p>
</div><div data-title="Support unmonitor command" data-file="../src/lamda/lib/bot-webhook.js" data-highlight="64-76" class="step"><h2 id="support-unmonitor-command">Support unmonitor command</h2>
<p>When you post <code>@botID unmonitor</code>, bot did not response, let&#39;s uncomment the code and restart the server to make it work.</p>
</div><div data-title="Write a custom command support" data-file="../src/lamda/lib/bot-webhook.js" data-highlight="92-94" class="step"><h2 id="write-a-custom-command-support">Write a custom command support</h2>
<p>Now you can see how the bot command works, try write one yourself.</p>
</div><div data-title="Just tell chat group how many new voicemail there" data-file="../src/lamda/lib/user-webhook.js" data-highlight="24-40" class="step"><h2 id="just-tell-chat-group-how-many-new-voicemail-there">Just tell chat group how many new voicemail there</h2>
<p>Let&#39;s replace the default voicemail process by simply tell user how many new voicemail got by comment out line 33-35, uncomment line 67-75</p>
</div><div data-title="Write custom voicemail reponse" data-file="../src/lamda/lib/user-webhook.js" data-highlight="24-40" class="step"><h2 id="write-custom-voicemail-reponse">Write custom voicemail reponse</h2>
<p>The last practice!</p>
<p>Replace line33-35, write you own process function, send some custom reponse about new voice mail.</p>
<p>That&#39; all for now, have fun with the bot coding~</p>
</div>
<div class="saurus-files" style="display:none;"><textarea class="saurus-file" data-file="../README.md" data-mode="markdown">IyBSaW5nQ2VudHJhbCBBSSBCb3QKClJpbmdDZW50cmFsIEdsaXAgdm9pY2VtYWlsIEFJIGJvdCBQT0MuCgojIyBGZWF0dXJlcwpSZWFkIEdsaXAgdXNlcidzIG5ldyB2b2ljZW1haWwsIHRyYW5zY3JpYmUgdGhlIHZvaWNlIHRvIHRleHQsIGFuYWx5emUgdGhlIHRleHQgd2l0aCBHb29nbGUgQUksIGFuZCBzZW5kIHRoZSByZXN1bHRzIHRvIHVzZXIgYXV0aHVyaXplZCBjaGF0IGdyb3VwLgoKIyMgUHJlcmVxdWlzaXRlcwoKLSBOb2RlLmpzID49IDguMTAKLSBDcmVhdGUgYSBib3QgYXBwIGluIFtSaW5nQ2VudHJhbCBkZXZlbG9wZXIgc2l0ZV0oaHR0cHM6Ly9kZXZlbG9wZXJzLnJpbmdjZW50cmFsLmNvbSksIHdpdGggcGVybWlzc2lvbnM6IGBSZWFkQ29udGFjdHMgUmVhZE1lc3NhZ2VzIFJlYWRQcmVzZW5jZSBDb250YWN0cyBSZWFkQWNjb3VudHMgU01TIEludGVybmFsTWVzc2FnZXMgUmVhZENhbGxMb2cgUmVhZENhbGxSZWNvcmRpbmcgU3Vic2NyaXB0aW9uV2ViaG9vayBHbGlwYAotIENyZWF0ZSBhIGJyb3dzZXIgYmFzZWQgYXBwIGluIFJpbmdDZW50cmFsIGRldmVsb3BlciBzaXRlLCB3aXRoIGFsbCBwZXJtaXNzaW9ucy4KCiMjIFByZXBhcmUgdGhlIGRldmVsb3BtZW50IGVudgoKYGBgYmFzaApnaXQgY2xvbmUgZ2l0QGdpdGh1Yi5jb206cmluZ2NlbnRyYWwtdHV0b3JpYWxzL3JpbmdjZW50cmFsLWFpLWJvdC5naXQKIyBvciBnaXQgY2xvbmUgaHR0cHM6Ly9naXRodWIuY29tL3JpbmdjZW50cmFsLXR1dG9yaWFscy9yaW5nY2VudHJhbC1haS1ib3QuZ2l0CmNkIHJpbmdjZW50cmFsLWFpLWJvdAp5YXJuCgojIGNyZWF0ZSBjb25maWcKY3AgLnNhbXBsZS5lbnYgLmVudgojIHRoZW4gZWRpdCAuZW52LCBmaWxsIHJpbmdjZW50cmFsIGFwcCBjb25maWdzCgojIyBzdGFydCBsb2NhbCBzZXJ2ZXIKeWFybiBkZXYKCiMjIHN0YXJ0IGEgbmdyb2sgcHJveHkgdG8gbG9jYWwgcG9ydAp5YXJuIHByb3h5CiMgaHR0cHM6Ly94eHh4eHgubmdyb2suaW8gLS0tPiBodHRwOi8vbG9jYWxob3N0Ojc4NjcKIyB5b3UgY2FuIGNoZWNrIG5ncm9rIHN0YXR1cyBmcm9tIGh0dHA6Ly9sb2NhbGhvc3Q6NDA0MApgYGAKLSBBZnRlciBzdGFydGVkIHRoZSBuZ3JvayBzZXJ2ZXIsIHlvdSBjYW4gc2V0IHlvdXIgcmluZ2NlbnRyYWwgYXBwJ3MgcmVkaXJlY3QgVVJMIHRvIGxhbWRhJ3MgYXBpIGdhdGV3YXkgdXJsLCBgaHR0cHM6Ly94eHh4eHgubmdyb2suaW8vYm90LW9hdXRoYCBmb3IgYm90IGFwcCwgYGh0dHBzOi8veHh4eHh4Lm5ncm9rLmlvL3VzZXItb2F1dGhgIGZvciB1c2VyIGFwcCwgbmdyb2sgd2lsbCBwcm94eSB0aGUgcmVxdWVzdCB0byB5b3VyIGxvY2FsIHNlcnZlci4KLSBHb3RvIHlvdXIgcmluZ2NlbnRyYWwgZGV2ZWxvcGVyIHNpdGUsIGluIGJvdCBhcHAncyBib3QgcGFnZSwgY2xpY2sgYEFkZCB0byBnbGlwYCwgVGhlbiBib3QgQWRkZWQsIHRpbWUgdG8gdGVzdCBpdC4KCiMjIFRlc3QgdGhlIGJvdAotIExvZ2luIHRvIGh0dHBzOi8vZ2xpcC1hcHAuZGV2dGVzdC5yaW5nY2VudHJhbC5jb20sIGNsaWNrIGJvdCdzIG5hbWUgdG8gc3RhcnQgdGhlIGNoYXQsIGp1c3QgZm9sbG93IHRoZSBib3QncyBpbnN0cnVjdGlvbnMuCgojIyBCdWlsZCBhbmQgUnVuIGluIHByb2R1Y3Rpb24gZW52Ci0gSW4gbG9jYWwgZGV2ZWxvcG1lbnQsIGJ5IGRlZmF1bHQgd2UgdXNlIGZha2UgZGF0YSB0byBzaW11bGF0ZSB0aGUgdm9pY2VtYWlsIHRyYW5zY3JpcHQgYW5kIGFuYWx5c2lzLCBpbiBwcm9kdWN0aW9uIHdlIHVzZSB0aGUgcmVhbCB0aGluZy4KLSBSZWdpc3RlciBHb29nbGUgY2xvdWQgYWNjb3VudCBhbmQgc2V0IHBheW1lbnQgbWV0aG9kLCBjcmVhdGUgYW4gcHJvamVjdCBhbmQgY3JlYXRlIGFuIGNyZWRlbnRpYWwsIGRvd25sb2FkIHlvdXIgY3JlZGVudGlhbCBqc29uLgotIFNldCBgR09PR0xFX0FQUExJQ0FUSU9OX0NSRURFTlRJQUxTPXlvdXIvZ29vZ2xlL2NyZWRlbnRpYWwvcGF0aGAgaW4gYC5lbnZgCi0gUmVzdGFydCBzZXJ2ZXIKCmBgYGJhc2gKIyBpbnN0YWxsIHBtMiBmaXJzdCBpZiB5b3Ugd2FubmEgdXNlIHBtMgp5YXJuIGdsb2JhbCBhZGQgcG0yCiMgb3IgYG5wbSBpIC1nIHBtMmAKCiMgYnVpbGQKeWFybiBidWlsZAoKIyBydW4gcHJvZHVjdGlvbiBzZXJ2ZXIKeWFybiBwcm9kLXNlcnZlcgoKIyB1c2UgcG0yCnBtMiBzdGFydCBiaW4vcG0yLnltbApgYGAKCiMjIEJ1aWxkIGFuZCBkZXBsb3kgdG8gQVdTIExhbWJkYQoKQVdTIGxhbWRhIHdpdGggYXBpIGdhdGUgd2F5IGFuZCBkeW5hbW9kYiB3b3VsZCBnaXZlIHVzIGEgZmxleGlibGUgd2F5IHRvIGRlcGxveSBib3QuCgotICoqT05MWSB3b3JrcyBpbiBsaW51eCoqLCBBV1MgbGFtZGEgaXMgaW4gbGludXggeDY0LCBzb21lIGRlcGVuZGVuY2llcyBuZWVkIHRvIGJlIHByZWJ1aWx0IGFuZCB1cGxvYWQgdG8gbGFtZGEsIHNvIG5lZWQgdGhlIGJ1aWxkIHByb2Nlc3MgaW4gbGludXggeDY0LCB5b3UgY291bGQgZG8gaXQgaW4gY2kgb3IgYW55IGxpbnV4IHNlcnZlci9kZXN0b3AgZW52LgoKLSBHZXQgYSBhd3MgYWNjb3VudCwgY3JlYXRlIGF3c19hY2Nlc3Nfa2V5X2lkIGFuZCBhd3Nfc2VjcmV0X2FjY2Vzc19rZXksIHB1dCBpdCBpbiBgfi8uYXdzL2NyZWRlbnRpYWxzYCwgbGlrZSB0aGlzOgpgYGBiYXNoCltkZWZhdWx0XQphd3NfYWNjZXNzX2tleV9pZCA9IDx5b3VyIGF3c19hY2Nlc3Nfa2V5X2lkPgphd3Nfc2VjcmV0X2FjY2Vzc19rZXkgPSA8eW91ciBhd3Nfc2VjcmV0X2FjY2Vzc19rZXk+CmBgYApyZWZlciB0byBodHRwczovL2RvY3MuYXdzLmFtYXpvbi5jb20vZ2VuZXJhbC9sYXRlc3QvZ3IvYXdzLXNlY3VyaXR5LWNyZWRlbnRpYWxzLmh0bWwuCgoKYGBgYmFzaApjcCBsYW1kYS9zZXJ2ZXJsZXNzLnNhbXBsZS55bWwgbGFtZGEvc2VydmVybGVzcy55bWwKYGBgCkVkaXQgYGxhbWRhL3NlcnZlcmxlc3MueW1sYCwgbWFrZSBzdXJlIHlvdSBzZXQgcHJvcGVyIG5hbWUgYW5kIHJlcXVpcmVkIGVudgpgYGB5bWwKIyB5b3UgY2FuIGRlZmluZSBzZXJ2aWNlIHdpZGUgZW52aXJvbm1lbnQgdmFyaWFibGVzIGhlcmUKICBlbnZpcm9ubWVudDoKICAgIE5PREVfRU5WOiBwcm9kdWN0aW9uCiAgICAjIHJpbmdjZW50cmFsIGFwcHMKCiAgICAjIyBib3RzCiAgICBSSU5HQ0VOVFJBTF9CT1RfQ0xJRU5UX0lEOgogICAgUklOR0NFTlRSQUxfQk9UX0NMSUVOVF9TRUNSRVQ6CgogICAgIyMgdXNlcgogICAgUklOR0NFTlRSQUxfVVNFUl9DTElFTlRfSUQ6CiAgICBSSU5HQ0VOVFJBTF9VU0VSX0NMSUVOVF9TRUNSRVQ6CgogICAgIyMgY29tbW9uCiAgICBSSU5HQ0VOVFJBTF9TRVJWRVI6IGh0dHBzOi8vcGxhdGZvcm0uZGV2dGVzdC5yaW5nY2VudHJhbC5jb20KICAgIFJJTkdDRU5UUkFMX0JPVF9TRVJWRVI6IGh0dHBzOi8veHh4eC5leGVjdXRlLWFwaS51cy1lYXN0LTEuYW1hem9uYXdzLmNvbS9kZWZhdWx0L3BvYy15b3VyLWJvdC1uYW1lLWRldi1ib3QKCiAgICAjIyBmb3IgZ29vZ2xlIGNsb3VkIGFwaSBjcmVuZGVudGlhbCBwYXRoCiAgICBHT09HTEVfQVBQTElDQVRJT05fQ1JFREVOVElBTFM6IHBhdGgvdG8vZ29vZ2xlLWNyZWRlbnRpYWwuanNvbgoKICAgICMgZGIKICAgIERCX1RZUEU6IGR5bmFtb2RiCiAgICBEWU5BTU9EQl9UQUJMRV9QUkVGSVg6IHJjX2FpX2JvdDEKICAgIERZTkFNT0RCX1JFR0lPTjogdXMtZWFzdC0xCgpgYGAKCkRlcGxveSB0byBhd3MgbGFtZGEgd2l0aCBgbnBtIHJ1biBkZXBsb3lgCmBgYGJhc2gKIyBtYWtlIHN1cmUgeW91IGhhdmUgeWFybiwgY291bGQgdXNlIGBucG0gaSAtZyB5YXJuIHRvIGluc3RhbGxgCiMgdGhlbiBydW4gdGhpcyBjbWQgdG8gZGVwbG95IHRvIGF3cyBsYW1kYSwgZnVsbCBidWlsZCwgbWF5IHRha2UgbW9yZSB0aW1lCm5wbSBydW4gZGVwbG95CgojIyB3YXRjaCBsYW1kYSBzZXJ2ZXIgbG9nCm5wbSBydW4gd2F0Y2gKCiMjIHVwZGF0ZSBmdW5jdGlvbgpucG0gcnVuIHVwZGF0ZQoKIyMgdXBkYXRlIHdpdGhvdXQgYnVpbGQsIGZhc3QgdXBkYXRlLCBubyByZWJ1aWxkCm5wbSBydW4gdQpgYGAKLSBDcmVhdGUgYXBpIGdhdGV3YXkgZm9yIHlvdXIgbGFtZGEgZnVuY3Rpb24sIHNoYXBlIGFzIGBodHRwczovL3h4eHguZXhlY3V0ZS1hcGkudXMtZWFzdC0xLmFtYXpvbmF3cy5jb20vZGVmYXVsdC9wb2MteW91ci1ib3QtbmFtZS1kZXYtYm90L3thY3Rpb24rfWAKLSBNYWtlIHN1cmUgeW91ciBsYW1kYSBmdW5jdGlvbiByb2xlIGhhcyBwZXJtaXNzaW9uIHRvIHJlYWQvd3JpdGUgZHluYW1vZGIoU2V0IHRoaXMgZnJvbSBhd3MgSUFNIHJvbGVzLCBjb3VsZCBzaW1wbHkgYXR0YWNoIGBBbWF6b25EeW5hbW9EQkZ1bGxBY2Nlc3NgIHBvbGljeSB0byBsYW1kYSBmdW5jdGlvbidzIHJvbGUpCi0gTWFrZSBzdXJlIHlvdXIgbGFtZGEgZnVuY3Rpb24ncyB0aW1lb3V0IG1vcmUgdGhhbiA1IG1pbnV0ZXMKLSBEbyBub3QgZm9yZ2V0IHRvIHNldCB5b3VyIHJpbmdjZW50cmFsIGFwcCdzIHJlZGlyZWN0IFVSTCB0byBsYW1kYSdzIGFwaSBnYXRld2F5IHVybCwgYGh0dHBzOi8veHh4eC5leGVjdXRlLWFwaS51cy1lYXN0LTEuYW1hem9uYXdzLmNvbS9kZWZhdWx0L3BvYy15b3VyLWJvdC1uYW1lLWRldi1ib3QvYm90LW9hdXRoYCBmb3IgYm90IGFwcCwgYGh0dHBzOi8veHh4eC5leGVjdXRlLWFwaS51cy1lYXN0LTEuYW1hem9uYXdzLmNvbS9kZWZhdWx0L3BvYy15b3VyLWJvdC1uYW1lLWRldi1ib3QvdXNlci1vYXV0aGAgZm9yIHVzZXIgYXBwLgoKIyMgRWRpdCB0dXRvcmlhbApUaGlzIHJlcG8gYWxzbyBzZXJ2ZXMgYXMgYSB0dXRvcmlhbCBpbiBodHRwczovL3JpbmdjZW50cmFsLXR1dG9yaWFscy5naXRodWIuaW8vcmluZ2NlbnRyYWwtYWktYm90LgpgYGAKIyBpbnN0YWxsIGRlcHMKeWFybgoKIyBzdGFydCBsb2NhbCBkb2NzIHNlcnZlcgp5YXJuIGRvY3MKYGBgClRoZW4gdmlzaXQgaHR0cDovL2xvY2FsaG9zdDo4ODg4IHRvIGNoZWNrIHRoZSB0dXRvcmlhbAoKWW91IGNhbiBlZGl0IGBkb2NzL3R1dG9yaWFsL2luZGV4LmphZGVgLCBkb2NzIHdpbGwgYXV0byB1cGRhdGUgYGRvY3MvaW5kZXguaHRtbGAsIHJlZnJlc2ggaHR0cDovL2xvY2FsaG9zdDo4ODg4IHRvIHNlZSB0aGUgY2hhbmdlLgoKIyMgQ3JlZGl0cwotIFRoZSBjb25jZXB0IG9mIHRoaXMgYm90IGlzIGRlc2lnbmVkIGJ5IFtAZ3Jva2lmeV0oaHR0cHM6Ly9naXRodWIuY29tL2dyb2tpZnkpCi0gW0B0eWxlcmxvbmddKGh0dHBzOi8vZ2l0aHViLmNvbS90eWxlcmxvbmcpIFdyb3RlIHRoZSBjb3JlIGJvdCBsb2dpYwoKIyMgRG9jdW1lbnRzICYgUmVmZXJlbmNlCi0gaHR0cHM6Ly9kZXZlbG9wZXIucmluZ2NlbnRyYWwuY29tL2xlZ2FjeS1hcGktcmVmZXJlbmNlL2luZGV4Lmh0bWwjISNPdmVydmlldy5odG1sCi0gaHR0cHM6Ly9yaW5nY2VudHJhbC1hcGktZG9jcy5yZWFkdGhlZG9jcy5pby9lbi9sYXRlc3QvZ2xpcF9ib3RzLwotIGh0dHBzOi8vZ2l0aHViLmNvbS9ncm9raWZ5L3JpbmdjZW50cmFsLXBvbGxpbmctYW5kLXN5bmNpbmcKLSBodHRwczovL2dpdGh1Yi5jb20vcmluZ2NlbnRyYWwvcmluZ2NlbnRyYWwtanMKLSBodHRwczovL2dpdGh1Yi5jb20vdHlsZXJsb25nL3JpbmdjZW50cmFsLWpzLWNvbmNpc2UKLSBodHRwczovL2dpdGh1Yi5jb20vZ3Jva2lmeS9ncm91cGJvdAotIGh0dHBzOi8vZ2l0aHViLmNvbS90eWxlcmxvbmcvc3VieAotIGh0dHBzOi8vZ2l0aHViLmNvbS96eGRvbmcyNjIvYXVkaW8tYW5hbHlzaXMtc2VydmljZSAoVm9pY2UgdHJhbnNjcmlwdC9hbmFseXNpcyByZWxhdGVkIGV4dGVybmFsIHNlcnZpY2UpCgojIyBMaWNlbnNlCgpNSVQKCg==</textarea>
<textarea class="saurus-file" data-file="../src/lamda/lib/bot-oauth.js" data-mode="javascript">LyoqCiAqIHVzZXIgb2F1dGggYnkgdHlsZXIKICovCgppbXBvcnQge3Jlc3VsdH0gZnJvbSAnLi9jb21tb24nCgppbXBvcnQge0JvdH0gZnJvbSAnLi9zdG9yZScKCmV4cG9ydCBkZWZhdWx0IGFzeW5jIChldmVudCkgPT4gewogIGNvbnN0IGJvdCA9IG5ldyBCb3QoKQogIGF3YWl0IGJvdC5hdXRob3JpemUoZXZlbnQucXVlcnlTdHJpbmdQYXJhbWV0ZXJzLmNvZGUpCiAgYXdhaXQgYm90LnJlbmV3V2ViSG9va3MoKQogIHJldHVybiByZXN1bHQoJ0JvdCBhZGRlZCcpCn0K</textarea>
<textarea class="saurus-file" data-file="../src/lamda/lib/store.js" data-mode="javascript">CmltcG9ydCBTdWJ4IGZyb20gJ3N1YngnCmltcG9ydCBSaW5nQ2VudHJhbCBmcm9tICdyaW5nY2VudHJhbC1qcy1jb25jaXNlJwppbXBvcnQge3Byb2Nlc3NNYWlsfSBmcm9tICcuL3ZvaWNlbWFpbC1wcm9jZXNzJwppbXBvcnQgZGIgZnJvbSAnLi9kYicKaW1wb3J0IHsKICBsb2csIHRhYmxlcywgcmVzdWx0Rm9ybWF0dGVyLCBkZWJ1ZywKICBzdWJzY3JpYmVJbnRlcnZhbCwgZXhwaXJlc0luLCBoYW5kbGVSQ0Vycm9yCn0gZnJvbSAnLi9jb21tb24nCmltcG9ydCBfIGZyb20gJ2xvZGFzaCcKCmNvbnN0IGJvdEV2ZW50RmlsdGVycyA9ICgpID0+IFsKICAnL3Jlc3RhcGkvdjEuMC9nbGlwL3Bvc3RzJywKICAnL3Jlc3RhcGkvdjEuMC9nbGlwL2dyb3VwcycKXQoKY29uc3QgdXNlckV2ZW50RmlsdGVycyA9ICgpID0+IFsKICAnL3Jlc3RhcGkvdjEuMC9hY2NvdW50L34vZXh0ZW5zaW9uL34vbWVzc2FnZS1zdG9yZScsCiAgc3Vic2NyaWJlSW50ZXJ2YWwoKQpdCgpmdW5jdGlvbiBjYXBpdGFsaXplRmlyc3RMZXR0ZXIoc3RyaW5nKSB7CiAgcmV0dXJuIHN0cmluZy5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHN0cmluZy5zbGljZSgxKQp9CgovL2J1aWxkIHN0b3JlIGZ1bmN0aW9ucwpmdW5jdGlvbiBnZXRTdG9yZSAoKSB7CiAgbGV0IHN1YnhlZCA9IFsndXNlcicsICdib3QnXQogIHJldHVybiB0YWJsZXMucmVkdWNlKChwcmV2LCB0YWJsZSkgPT4gewogICAgbGV0IGNhcCA9IGNhcGl0YWxpemVGaXJzdExldHRlcih0YWJsZSkKICAgIHJldHVybiB7CiAgICAgIC4uLnByZXYsCiAgICAgIFtgZ2V0JHtjYXB9YF06IGFzeW5jIGZ1bmN0aW9uKGlkKSB7CiAgICAgICAgbGV0IGl0ZW0gPSB7fQogICAgICAgIGl0ZW0gPSBhd2FpdCBkYi5kYkFjdGlvbih0YWJsZSwgJ2dldCcsIHtpZH0pCiAgICAgICAgaWYgKCFzdWJ4ZWQuaW5jbHVkZXModGFibGUpKSB7CiAgICAgICAgICByZXR1cm4gaXRlbQogICAgICAgIH0KICAgICAgICBpZiAoIWl0ZW0pIHsKICAgICAgICAgIHJldHVybiBpdGVtCiAgICAgICAgfQogICAgICAgIHJldHVybiBjcmVhdGUoaXRlbSwgdGFibGUpCiAgICAgIH0sCiAgICAgIFtgcmVtb3ZlJHtjYXB9YF06IGZ1bmN0aW9uKGlkKSB7CiAgICAgICAgcmV0dXJuIGRiLmRiQWN0aW9uKHRhYmxlLCAncmVtb3ZlJywge2lkfSkKICAgICAgfSwKICAgICAgW2BhZGQke2NhcH1gXTogZnVuY3Rpb24oaXRlbSkgewogICAgICAgIHJldHVybiBkYi5kYkFjdGlvbih0YWJsZSwgJ2FkZCcsIGl0ZW0pCiAgICAgIH0KICAgIH0KICB9LCB7fSkKfQoKCmV4cG9ydCBjb25zdCBzdG9yZSA9IGdldFN0b3JlKCkKCi8vIEJvdApleHBvcnQgY29uc3QgQm90ID0gbmV3IFN1YngoewogIGdldCByYyAoKSB7CiAgICBjb25zdCByYyA9IG5ldyBSaW5nQ2VudHJhbCgKICAgICAgcHJvY2Vzcy5lbnYuUklOR0NFTlRSQUxfQk9UX0NMSUVOVF9JRCwKICAgICAgcHJvY2Vzcy5lbnYuUklOR0NFTlRSQUxfQk9UX0NMSUVOVF9TRUNSRVQsCiAgICAgIHByb2Nlc3MuZW52LlJJTkdDRU5UUkFMX1NFUlZFUgogICAgKQogICAgcmMudG9rZW4odGhpcy50b2tlbikKICAgIHJldHVybiByYwogIH0sCiAgYXN5bmMgd3JpdGVUb0RiKGl0ZW0pIHsKICAgIGlmIChpdGVtKSB7CiAgICAgIGF3YWl0IGRiLmRiQWN0aW9uKCdib3QnLCAnYWRkJywgaXRlbSkKICAgIH0gZWxzZSB7CiAgICAgIGF3YWl0IGRiLmRiQWN0aW9uKCdib3QnLCAndXBkYXRlJywgewogICAgICAgIGlkOiB0aGlzLmlkLAogICAgICAgIHVwZGF0ZTogewogICAgICAgICAgdG9rZW46IHRoaXMudG9rZW4KICAgICAgICB9CiAgICAgIH0pCiAgICB9CiAgfSwKICBhc3luYyBhdXRob3JpemUgKGNvZGUpIHsKICAgIHRyeSB7CiAgICAgIGF3YWl0IHRoaXMucmMuYXV0aG9yaXplKHsgY29kZSwgcmVkaXJlY3RVcmk6IHByb2Nlc3MuZW52LlJJTkdDRU5UUkFMX0JPVF9TRVJWRVIgKyAnL2JvdC1vYXV0aCcgfSkKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgaGFuZGxlUkNFcnJvcignQm90IGF1dGhvcml6ZScsIGUpCiAgICB9CiAgICBsZXQgdG9rZW4gPSB0aGlzLnJjLnRva2VuKCkKICAgIGxldCBpZCA9IHRva2VuLm93bmVyX2lkCiAgICB0aGlzLnRva2VuID0gdG9rZW4KICAgIHRoaXMuaWQgPSBpZAogICAgYXdhaXQgdGhpcy53cml0ZVRvRGIoewogICAgICBpZCwKICAgICAgdG9rZW4KICAgIH0pCiAgfSwKICBhc3luYyBzZXR1cFdlYkhvb2sgKCkgewogICAgdHJ5IHsKICAgICAgYXdhaXQgdGhpcy5yYy5wb3N0KCcvcmVzdGFwaS92MS4wL3N1YnNjcmlwdGlvbicsIHsKICAgICAgICBldmVudEZpbHRlcnM6IGJvdEV2ZW50RmlsdGVycygpLAogICAgICAgIGV4cGlyZXNJbjogNTAwMDAwMDAwLAogICAgICAgIGRlbGl2ZXJ5TW9kZTogewogICAgICAgICAgdHJhbnNwb3J0VHlwZTogJ1dlYkhvb2snLAogICAgICAgICAgYWRkcmVzczogcHJvY2Vzcy5lbnYuUklOR0NFTlRSQUxfQk9UX1NFUlZFUiArICcvYm90LXdlYmhvb2snCiAgICAgICAgfQogICAgICB9KQogICAgfSBjYXRjaCAoZSkgewogICAgICBsZXQgZGF0YSA9IF8uZ2V0KGUsICdyZXNwb25zZS5kYXRhJykgfHwge30KICAgICAgbGV0IHN0ciA9IEpTT04uc3RyaW5naWZ5KGRhdGEpCiAgICAgIGlmIChzdHIuaW5jbHVkZXMoJ1NVQi00MDYnKSkgewogICAgICAgIGxvZygnYm90IHN1YnNjcmliZSBmYWlsLCB3aWxsIGRvIHN1YnNjcmliZSBvbmUgbWludXRlcyBsYXRlcicpCiAgICAgICAgc2V0VGltZW91dCgKICAgICAgICAgICgpID0+IHRoaXMucmVuZXdXZWJIb29rcygpLAogICAgICAgICAgNjAgKiAxMDAwCiAgICAgICAgKQogICAgICB9IGVsc2UgewogICAgICAgIGhhbmRsZVJDRXJyb3IoJ0JvdCBzZXR1cFdlYkhvb2snLCBlKQogICAgICAgIHRocm93IGUKICAgICAgfQogICAgfQogIH0sCiAgYXN5bmMgcmVuZXdXZWJIb29rcyAoKSB7CiAgICB0cnkgewogICAgICBjb25zdCByID0gYXdhaXQgdGhpcy5yYy5nZXQoJy9yZXN0YXBpL3YxLjAvc3Vic2NyaXB0aW9uJykKICAgICAgbGV0IGZpbHRlcmVkID0gci5kYXRhLnJlY29yZHMuZmlsdGVyKAogICAgICAgIHIgPT4gewogICAgICAgICAgcmV0dXJuIHIuZGVsaXZlcnlNb2RlLmFkZHJlc3MgPT09IHByb2Nlc3MuZW52LlJJTkdDRU5UUkFMX0JPVF9TRVJWRVIgKyAnL2JvdC13ZWJob29rJwogICAgICAgIH0KICAgICAgKQogICAgICBkZWJ1ZygnYm90IHN1YnMgbGlzdCcsIGZpbHRlcmVkLm1hcChnID0+IGcuaWQpLmpvaW4oJywnKSkKICAgICAgYXdhaXQgdGhpcy5zZXR1cFdlYkhvb2soKQogICAgICBmb3IgKGxldCBzdWIgb2YgZmlsdGVyZWQpIHsKICAgICAgICBhd2FpdCB0aGlzLmRlbFN1YnNjcmlwdGlvbihzdWIuaWQpCiAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgaGFuZGxlUkNFcnJvcignYm90IHJlbmV3V2ViSG9va3MnLCBlKQogICAgfQogIH0sCiAgYXN5bmMgZGVsU3Vic2NyaXB0aW9uIChpZCkgewogICAgZGVidWcoJ2RlbCBib3Qgc3ViIGlkOicsIGlkKQogICAgdHJ5IHsKICAgICAgYXdhaXQgdGhpcy5yYy5kZWxldGUoYC9yZXN0YXBpL3YxLjAvc3Vic2NyaXB0aW9uLyR7aWR9YCkKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgaGFuZGxlUkNFcnJvcignYm90IGRlbFN1YnNjcmlwdGlvbicsIGUpCiAgICB9CiAgfSwKICBhc3luYyBzZW5kTWVzc2FnZSAoZ3JvdXBJZCwgbWVzc2FnZU9iaikgewogICAgdHJ5IHsKICAgICAgYXdhaXQgdGhpcy5yYy5wb3N0KGAvcmVzdGFwaS92MS4wL2dsaXAvZ3JvdXBzLyR7Z3JvdXBJZH0vcG9zdHNgLCBtZXNzYWdlT2JqKQogICAgfSBjYXRjaCAoZSkgewogICAgICBoYW5kbGVSQ0Vycm9yKCdCb3Qgc2VuZE1lc3NhZ2UnLCBlKQogICAgfQogIH0sCiAgYXN5bmMgdmFsaWRhdGUgKCkgewogICAgdHJ5IHsKICAgICAgYXdhaXQgdGhpcy5yYy5nZXQoJy9yZXN0YXBpL3YxLjAvYWNjb3VudC9+L2V4dGVuc2lvbi9+JykKICAgICAgcmV0dXJuIHRydWUKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgaGFuZGxlUkNFcnJvcignQm90IHZhbGlkYXRlJywgZSkKICAgICAgY29uc3QgZXJyb3JDb2RlID0gXy5nZXQoZSwgJ3Jlc3BvbnNlLmRhdGEuZXJyb3JDb2RlJykKICAgICAgaWYgKGVycm9yQ29kZSA9PT0gJ09BVS0yMzInIHx8IGVycm9yQ29kZSA9PT0gJ0NNTi00MDUnKSB7CiAgICAgICAgYXdhaXQgc3RvcmUucmVtb3ZlQm90W3RoaXMuaWRdCiAgICAgICAgbG9nKGBCb3QgdXNlciAke3RoaXMuaWR9IGhhcyBiZWVuIGRlbGV0ZWRgKQogICAgICAgIHJldHVybiBmYWxzZQogICAgICB9CiAgICB9CiAgfQp9KQoKLy8gVXNlcgpleHBvcnQgY29uc3QgVXNlciA9IG5ldyBTdWJ4KHsKICBncm91cHM6IHt9LAogIGdldCByYyAoKSB7CiAgICBjb25zdCByYyA9IG5ldyBSaW5nQ2VudHJhbCgKICAgICAgcHJvY2Vzcy5lbnYuUklOR0NFTlRSQUxfVVNFUl9DTElFTlRfSUQsCiAgICAgIHByb2Nlc3MuZW52LlJJTkdDRU5UUkFMX1VTRVJfQ0xJRU5UX1NFQ1JFVCwKICAgICAgcHJvY2Vzcy5lbnYuUklOR0NFTlRSQUxfU0VSVkVSCiAgICApCiAgICByYy50b2tlbih0aGlzLnRva2VuKQogICAgcmV0dXJuIHJjCiAgfSwKICBhc3luYyB3cml0ZVRvRGIoaXRlbSkgewogICAgaWYgKGl0ZW0pIHsKICAgICAgYXdhaXQgZGIuZGJBY3Rpb24oJ3VzZXInLCAnYWRkJywgaXRlbSkKICAgIH0gZWxzZSB7CiAgICAgIGF3YWl0IGRiLmRiQWN0aW9uKCd1c2VyJywgJ3VwZGF0ZScsIHsKICAgICAgICBpZDogdGhpcy5pZCwKICAgICAgICB1cGRhdGU6IHsKICAgICAgICAgIHRva2VuOiB0aGlzLnRva2VuLAogICAgICAgICAgZ3JvdXBzOiB0aGlzLmdyb3VwcwogICAgICAgIH0KICAgICAgfSkKICAgIH0KICB9LAogIGF1dGhvcml6ZVVyaSAoZ3JvdXBJZCwgYm90SWQpIHsKICAgIHJldHVybiB0aGlzLnJjLmF1dGhvcml6ZVVyaShwcm9jZXNzLmVudi5SSU5HQ0VOVFJBTF9CT1RfU0VSVkVSICsgJy91c2VyLW9hdXRoJywgewogICAgICBzdGF0ZTogZ3JvdXBJZCArICc6JyArIGJvdElkLAogICAgICByZXNwb25zZVR5cGU6ICdjb2RlJwogICAgfSkKICB9LAogIGFzeW5jIGF1dGhvcml6ZSAoY29kZSkgewogICAgdHJ5IHsKICAgICAgYXdhaXQgdGhpcy5yYy5hdXRob3JpemUoeyBjb2RlLCByZWRpcmVjdFVyaTogcHJvY2Vzcy5lbnYuUklOR0NFTlRSQUxfQk9UX1NFUlZFUiArICcvdXNlci1vYXV0aCcgfSkKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgaGFuZGxlUkNFcnJvcignVXNlciBhdXRob3JpemUnLCBlKQogICAgfQogICAgbGV0IHRva2VuID0gdGhpcy5yYy50b2tlbigpCiAgICBsZXQgaWQgPSB0b2tlbi5vd25lcl9pZAogICAgdGhpcy50b2tlbiA9IHRva2VuCiAgICB0aGlzLmlkID0gaWQKICAgIGF3YWl0IHRoaXMud3JpdGVUb0RiKHsKICAgICAgaWQsCiAgICAgIHRva2VuLAogICAgICBncm91cHM6IHt9CiAgICB9KQogIH0sCiAgYXN5bmMgcmVmcmVzaCAoKSB7CiAgICB0cnkgewogICAgICBhd2FpdCB0aGlzLnJjLnJlZnJlc2goKQogICAgICB0aGlzLnRva2VuID0gdGhpcy5yYy50b2tlbigpCiAgICB9IGNhdGNoKGUpIHsKICAgICAgaGFuZGxlUkNFcnJvcignVXNlciByZWZyZXNoIHRva2VuJywgZSkKICAgICAgYXdhaXQgc3RvcmUucmVtb3ZlVXNlcih0aGlzLmlkKQogICAgICBsb2coYFVzZXIgJHt0aGlzLnRva2VuLm93bmVyX2lkfSByZWZyZXNoIHRva2VuIGhhcyBleHBpcmVkYCkKICAgIH0KICB9LAogIGFzeW5jIHJlbmV3V2ViSG9va3MgKCkgewogICAgdHJ5IHsKICAgICAgY29uc3QgciA9IGF3YWl0IHRoaXMucmMuZ2V0KCcvcmVzdGFwaS92MS4wL3N1YnNjcmlwdGlvbicpCiAgICAgIGxldCBmaWx0ZXJlZCA9IHIuZGF0YS5yZWNvcmRzLmZpbHRlcigKICAgICAgICByID0+IHsKICAgICAgICAgIHJldHVybiByLmRlbGl2ZXJ5TW9kZS5hZGRyZXNzID09PSBwcm9jZXNzLmVudi5SSU5HQ0VOVFJBTF9CT1RfU0VSVkVSICsgJy91c2VyLXdlYmhvb2snCiAgICAgICAgfQogICAgICApCiAgICAgIGxvZygndXNlciBzdWJzIGxpc3QnLCBmaWx0ZXJlZC5tYXAoZyA9PiBnLmlkKS5qb2luKCcsJykpCiAgICAgIGF3YWl0IHRoaXMuc2V0dXBXZWJIb29rKCkKICAgICAgZm9yIChsZXQgc3ViIG9mIGZpbHRlcmVkKSB7CiAgICAgICAgYXdhaXQgdGhpcy5kZWxTdWJzY3JpcHRpb24oc3ViLmlkKQogICAgICB9CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGhhbmRsZVJDRXJyb3IoJ3VzZXIgcmVuZXdXZWJIb29rcycsIGUpCiAgICB9CiAgfSwKICBhc3luYyBkZWxTdWJzY3JpcHRpb24gKGlkKSB7CiAgICB0cnkgewogICAgICBhd2FpdCB0aGlzLnJjLmRlbGV0ZShgL3Jlc3RhcGkvdjEuMC9zdWJzY3JpcHRpb24vJHtpZH1gKQogICAgfSBjYXRjaCAoZSkgewogICAgICBoYW5kbGVSQ0Vycm9yKGB1c2VyIGRlbFN1YnNjcmlwdGlvbiAke2lkfWAsIGUpCiAgICB9CiAgfSwKICBhc3luYyBzZXR1cFdlYkhvb2sgKCkgeyAvLyBzZXR1cCBXZWJIb29rIGZvciB2b2ljZW1haWwKICAgIHRyeSB7CiAgICAgIGF3YWl0IHRoaXMucmMucG9zdCgnL3Jlc3RhcGkvdjEuMC9zdWJzY3JpcHRpb24nLCB7CiAgICAgICAgZXZlbnRGaWx0ZXJzOiB1c2VyRXZlbnRGaWx0ZXJzKCksCiAgICAgICAgZXhwaXJlc0luOiBleHBpcmVzSW4oKSwKICAgICAgICBkZWxpdmVyeU1vZGU6IHsKICAgICAgICAgIHRyYW5zcG9ydFR5cGU6ICdXZWJIb29rJywKICAgICAgICAgIGFkZHJlc3M6IHByb2Nlc3MuZW52LlJJTkdDRU5UUkFMX0JPVF9TRVJWRVIgKyAnL3VzZXItd2ViaG9vaycKICAgICAgICB9CiAgICAgIH0pCiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGhhbmRsZVJDRXJyb3IoJ1VzZXIgc2V0dXBXZWJIb29rJywgZSkKICAgIH0KICB9LAogIGFzeW5jIHJlbW92ZUdyb3VwKGlkKSB7CiAgICBkZWxldGUgdGhpcy5ncm91cHNbaWRdCiAgICBhd2FpdCB0aGlzLndyaXRlVG9EYigpCiAgfSwKICBhc3luYyBhZGRHcm91cCAoZ3JvdXBJZCwgYm90SWQpIHsKICAgIGNvbnN0IGhhc05vR3JvdXAgPSBPYmplY3Qua2V5cyh0aGlzLmdyb3VwcykubGVuZ3RoID09PSAwCiAgICB0aGlzLmdyb3Vwc1tncm91cElkXSA9IGJvdElkCiAgICBhd2FpdCB0aGlzLndyaXRlVG9EYigpCiAgICBpZiAoaGFzTm9Hcm91cCkgewogICAgICBhd2FpdCB0aGlzLnNldHVwV2ViSG9vaygpCiAgICB9CiAgfSwKICBhc3luYyBnZXRWb2ljZU1haWxzIChjb3VudCkgewogICAgY29uc3QgciA9IGF3YWl0IHRoaXMucmMuZ2V0KCcvcmVzdGFwaS92MS4wL2FjY291bnQvfi9leHRlbnNpb24vfi9tZXNzYWdlLXN0b3JlJywgewogICAgICBwYXJhbXM6IHsKICAgICAgICBtZXNzYWdlVHlwZTogJ1ZvaWNlTWFpbCcsCiAgICAgICAgcGVyUGFnZTogY291bnQKICAgICAgfQogICAgfSkKICAgIHJldHVybiByLmRhdGEucmVjb3JkcwogIH0sCiAgLyoKICBhc3luYyBzeW5jVm9pY2VNYWlscyAocGFyYW1zID0gewogICAgcmVjb3JkQ291bnQ6IDEwLAogICAgc3luY1R5cGU6ICdGU3luYycKICB9KSB7CiAgICBjb25zdCByID0gYXdhaXQgdGhpcy5yYy5nZXQoJy9yZXN0YXBpL3YxLjAvYWNjb3VudC9+L2V4dGVuc2lvbi9+L21lc3NhZ2Utc3luYycsIHsKICAgICAgcGFyYW1zOiB7CiAgICAgICAgLi4ucGFyYW1zLAogICAgICAgIG1lc3NhZ2VUeXBlOiAnVm9pY2VNYWlsJwogICAgICB9CiAgICB9KQogICAgcmV0dXJuIHIuZGF0YS5yZWNvcmRzCiAgfSwKICAqLwogIGFzeW5jIHByb2Nlc3NWb2ljZU1haWwgKG5ld01haWxDb3VudCA9IDEwKSB7CiAgICBpZiAoIU9iamVjdC5rZXlzKHRoaXMuZ3JvdXBzKSkgewogICAgICByZXR1cm4KICAgIH0KICAgIGxldCB2b2ljZU1haWxzID0gYXdhaXQgdGhpcy5nZXRWb2ljZU1haWxzKG5ld01haWxDb3VudCkKICAgIGxldCB1c2VySWQgPSB0aGlzLmlkCiAgICBsZXQgaGVhZGVycyA9IHRoaXMucmMuX2JlYXJlckF1dGhvcml6YXRpb25IZWFkZXIoKQogICAgZm9yIChsZXQgbWFpbCBvZiB2b2ljZU1haWxzKSB7CiAgICAgIGxldCBtc2cgPSBhd2FpdCBwcm9jZXNzTWFpbChtYWlsLCBoZWFkZXJzKQogICAgICBhd2FpdCB0aGlzLnNlbmRWb2ljZU1haWxJbmZvKAogICAgICAgIHJlc3VsdEZvcm1hdHRlcih1c2VySWQsIG1zZyB8fCB7fSkKICAgICAgKQogICAgfQogIH0sCiAgYXN5bmMgc2VuZFZvaWNlTWFpbEluZm8gKHByb2Nlc3NlZE1haWxJbmZvID0gJycpIHsKICAgIGZvciAoY29uc3QgZ3JvdXBJZCBvZiBPYmplY3Qua2V5cyh0aGlzLmdyb3VwcykpIHsKICAgICAgY29uc3QgYm90SWQgPSB0aGlzLmdyb3Vwc1tncm91cElkXQogICAgICBjb25zdCBib3QgPSBhd2FpdCBzdG9yZS5nZXRCb3QoYm90SWQpCiAgICAgIGF3YWl0IGJvdC5zZW5kTWVzc2FnZSgKICAgICAgICBncm91cElkLAogICAgICAgIHsgdGV4dDogcHJvY2Vzc2VkTWFpbEluZm8gfQogICAgICApCiAgICB9CiAgfQp9KQoKLyoqCiAqIGNyZWF0ZSBpbnN0YW5jZSBmcm9tIHVzZXIvYm90IGluZm8KICogQHBhcmFtIHtvYmplY3R9IGl0ZW0KICogQHBhcmFtIHsqfSB0eXBlIAogKi8KYXN5bmMgZnVuY3Rpb24gY3JlYXRlKGl0ZW0sIHR5cGUpIHsKICBsZXQgZGljdCA9IHsKICAgIGJvdDogQm90LAogICAgdXNlcjogVXNlcgogIH0KICBsZXQgaW5zdCA9IG5ldyBkaWN0W3R5cGVdKGl0ZW0pCiAgcmV0dXJuIGluc3QKfQo=</textarea>
<textarea class="saurus-file" data-file="../src/lamda/lib/bot-webhook.js" data-mode="javascript">LyoqCiAqIHVzZXIgb2F1dGggYnkgdHlsZXIKICovCgppbXBvcnQge3Jlc3VsdH0gZnJvbSAnLi9jb21tb24nCmltcG9ydCB7VXNlciwgc3RvcmV9IGZyb20gJy4vc3RvcmUnCgpleHBvcnQgZGVmYXVsdCBhc3luYyAoZXZlbnQpID0+IHsKICBjb25zdCBtZXNzYWdlID0gZXZlbnQuYm9keQogIGxldCB7IGJvZHkgfSA9IG1lc3NhZ2UKICBsZXQgbXNnID0gcmVzdWx0KCdib3QgV2ViSG9vayByZXBsaWVkJywgMjAwLCB7CiAgICBoZWFkZXJzOiB7CiAgICAgICd2YWxpZGF0aW9uLXRva2VuJzogZXZlbnQuaGVhZGVyc1sndmFsaWRhdGlvbi10b2tlbiddIHx8IGV2ZW50LmhlYWRlcnNbJ1ZhbGlkYXRpb24tVG9rZW4nXQogICAgfQogIH0pCiAgaWYgKCFib2R5KSB7CiAgICByZXR1cm4gbXNnCiAgfQoKICBsZXQgYm90SWQgPSBtZXNzYWdlLm93bmVySWQKCiAgLy9oYW5kbGUgZXhwaXJlIHJlbWluZGVyIGV2ZW50LCByZXN1YnNjcmliZQogIC8vIGlmIChtZXNzYWdlLmV2ZW50ID09PSBzdWJzY3JpYmVJbnRlcnZhbCgpKSB7CiAgLy8gICBsZXQgYm90MSA9IGF3YWl0IHN0b3JlLmdldEJvdChib3RJZCkKICAvLyAgIGlmIChib3QxKSB7CiAgLy8gICAgIGF3YWl0IGJvdDEucmVuZXdXZWJIb29rcygpCiAgLy8gICB9CiAgLy8gICByZXR1cm4gbXNnCiAgLy8gfQoKICBzd2l0Y2ggKGJvZHkuZXZlbnRUeXBlKSB7CgogICAgLy9ib3Qgam9pbiBncm91cAogICAgY2FzZSAnR3JvdXBKb2luZWQnOgogICAgICBpZiAoYm9keS50eXBlID09PSAnUHJpdmF0ZUNoYXQnKSB7CiAgICAgICAgY29uc3QgYm90ID0gYXdhaXQgc3RvcmUuZ2V0Qm90KGJvdElkKQogICAgICAgIGlmICghYm90KSB7CiAgICAgICAgICBicmVhawogICAgICAgIH0KICAgICAgICBhd2FpdCBib3Quc2VuZE1lc3NhZ2UoCiAgICAgICAgICBib2R5LmlkLAogICAgICAgICAgewogICAgICAgICAgICB0ZXh0OiBgSGVsbG8sIEkgYW0gYSBjaGF0Ym90LgpQbGVhc2UgcmVwbHkgIiFbOlBlcnNvbl0oJHtib3RJZH0pIiBpZiB5b3Ugd2FudCB0byB0YWxrIHRvIG1lLmAKICAgICAgICAgIH0KICAgICAgICApCiAgICAgIH0KICAgICAgYnJlYWsKCiAgICAvL2JvdCBnb3QgcG9zdAogICAgY2FzZSAnUG9zdEFkZGVkJzoKCiAgICAgIC8vb25seSByZXNwb25kIHRvIEBib3QgZXZlbnQKICAgICAgaWYgKGJvZHkuY3JlYXRvcklkID09PSBib3RJZCB8fCBib2R5LnRleHQuaW5kZXhPZihgIVs6UGVyc29uXSgke2JvdElkfSlgKSA9PT0gLTEpIHsKICAgICAgICBicmVhawogICAgICB9CiAgICAgIHZhciBib3QgPSBhd2FpdCBzdG9yZS5nZXRCb3QoYm90SWQpCgogICAgICAvL25vIGJvdCBpbiBkYXRhYmFzZQogICAgICBpZiAoIWJvdCkgewogICAgICAgIGJyZWFrCiAgICAgIH0KCiAgICAgIC8vIHVzZXIgdW5tb25pdCB2b2ljZW1haWwsCiAgICAgIC8vIHRvZG86IHVuY29tbWVudCBsaW5lNjctNzUgdG8gc3VwcG9ydCB1bm1vbml0b3IgY29tbWFuZAogICAgICBpZiAoL1xidW5tb25pdG9yXGIvaS50ZXN0KGJvZHkudGV4dCkpIHsKICAgICAgICAvLyBjb25zdCB1c2VyID0gYXdhaXQgc3RvcmUuZ2V0VXNlcihib2R5LmNyZWF0b3JJZCkKICAgICAgICAvLyBpZiAodXNlcikgewogICAgICAgIC8vICAgYXdhaXQgdXNlci5yZW1vdmVHcm91cChib2R5Lmdyb3VwSWQpCiAgICAgICAgLy8gICBhd2FpdCBib3Quc2VuZE1lc3NhZ2UoYm9keS5ncm91cElkLCB7IHRleHQ6IGAhWzpQZXJzb25dKCR7Ym9keS5jcmVhdG9ySWR9KSwgc3RvcCBtb25pdG9yIHlvdXIgdm9pY2VtYWlsIG5vdyFcbklmIHlvdSB3YW50IG1lIHRvIG1vbml0b3IgeW91ciB2b2ljZW1haWwgYWdhaW4sIHBsZWFzZSByZXBseSAiIVs6UGVyc29uXSgke2JvdElkfSkgbW9uaXRvciJgIH0pCiAgICAgICAgLy8gfSBlbHNlIHsKICAgICAgICAvLyAgIGF3YWl0IGJvdC5zZW5kTWVzc2FnZShib2R5Lmdyb3VwSWQsIHsKICAgICAgICAvLyAgICAgdGV4dDogYCFbOlBlcnNvbl0oJHtib2R5LmNyZWF0b3JJZH0pLCBJZiB5b3Ugd2FudCBtZSB0byBtb25pdG9yIHlvdXIgdm9pY2VtYWlsLCBwbGVhc2UgcmVwbHkgIiFbOlBlcnNvbl0oJHtib3RJZH0pIG1vbml0b3IiIGZpcnN0LmAKICAgICAgICAvLyAgIH0pCiAgICAgICAgLy8gfQogICAgICB9CgogICAgICAvL3VzZXIgbW9uaXQgdm9pY2VtYWlsCiAgICAgIGVsc2UgaWYgKC9cYm1vbml0b3JcYi9pLnRlc3QoYm9keS50ZXh0KSkgewogICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBzdG9yZS5nZXRVc2VyKGJvZHkuY3JlYXRvcklkKQogICAgICAgIGlmICh1c2VyKSB7CiAgICAgICAgICBhd2FpdCB1c2VyLmFkZEdyb3VwKGJvZHkuZ3JvdXBJZCwgYm90SWQpCiAgICAgICAgICBhd2FpdCBib3Quc2VuZE1lc3NhZ2UoYm9keS5ncm91cElkLCB7IHRleHQ6IGAhWzpQZXJzb25dKCR7Ym9keS5jcmVhdG9ySWR9KSwgbm93IHlvdXIgdm9pY2VtYWlsIGlzIG1vbml0b3JlZCFcbklmIHlvdSB3YW50IG1lIHRvICoqc3RvcCBtb25pdG9yKiogeW91ciB2b2ljZW1haWwsIHBsZWFzZSByZXBseSAiIVs6UGVyc29uXSgke2JvdElkfSkgdW5tb25pdG9yImAgfSkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc3QgdXNlciA9IG5ldyBVc2VyKCkKICAgICAgICAgIGNvbnN0IGF1dGhvcml6ZVVyaSA9IHVzZXIuYXV0aG9yaXplVXJpKGJvZHkuZ3JvdXBJZCwgYm90SWQpCiAgICAgICAgICBhd2FpdCBib3Quc2VuZE1lc3NhZ2UoYm9keS5ncm91cElkLCB7CiAgICAgICAgICAgIHRleHQ6IGAhWzpQZXJzb25dKCR7Ym9keS5jcmVhdG9ySWR9KSwgW2NsaWNrIGhlcmVdKCR7YXV0aG9yaXplVXJpfSkgdG8gYXV0aG9yaXplIG1lIHRvIGFjY2VzcyB5b3VyIFJpbmdDZW50cmFsIGRhdGEgZmlyc3QuYAogICAgICAgICAgfSkKICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vdG9kbzogd3JpdGUgc29tZSBjb2RlIHRvIHN1cHBvcnQgYGhlbHBgIGNvbW1hbmQKCiAgICAgIC8vb3RoZXIgc2l0dWF0aW9uLCBqdXN0IHRpcCB1c2VyIHRvIG1vbml0CiAgICAgIGVsc2UgewogICAgICAgIGF3YWl0IGJvdC5zZW5kTWVzc2FnZShib2R5Lmdyb3VwSWQsIHsKICAgICAgICAgIHRleHQ6IGBJZiB5b3Ugd2FudCBtZSB0byBtb25pdG9yIHlvdXIgdm9pY2VtYWlsLCBwbGVhc2UgcmVwbHkgIiFbOlBlcnNvbl0oJHtib3RJZH0pIG1vbml0b3IiYAogICAgICAgIH0pCiAgICAgIH0KICAgICAgYnJlYWsKICAgIGRlZmF1bHQ6CiAgICAgIGJyZWFrCiAgfQoKICByZXR1cm4gbXNnCn0K</textarea>
<textarea class="saurus-file" data-file="../src/lamda/lib/user-oauth.js" data-mode="javascript">LyoqCiAqIHVzZXIgb2F1dGggYnkgdHlsZXIKICovCgppbXBvcnQge3Jlc3VsdH0gZnJvbSAnLi9jb21tb24nCmltcG9ydCB7VXNlciwgc3RvcmV9IGZyb20gJy4vc3RvcmUnCgpleHBvcnQgZGVmYXVsdCBhc3luYyAoZXZlbnQpID0+IHsKICBjb25zdCB1c2VyID0gbmV3IFVzZXIoKQogIGF3YWl0IHVzZXIuYXV0aG9yaXplKGV2ZW50LnF1ZXJ5U3RyaW5nUGFyYW1ldGVycy5jb2RlKQogIGNvbnN0IFtncm91cElkLCBib3RJZF0gPSBldmVudC5xdWVyeVN0cmluZ1BhcmFtZXRlcnMuc3RhdGUuc3BsaXQoJzonKQogIGNvbnN0IGJvdCA9IGF3YWl0IHN0b3JlLmdldEJvdChib3RJZCkKCiAgYXdhaXQgYm90LnNlbmRNZXNzYWdlKGdyb3VwSWQsIHsgdGV4dDogYCFbOlBlcnNvbl0oJHt1c2VyLnRva2VuLm93bmVyX2lkfSksIHlvdSBoYXZlIHN1Y2Nlc3NmdWxseSBhdXRob3JpemVkIG1lIHRvIGFjY2VzcyB5b3VyIFJpbmdDZW50cmFsIGRhdGEhYCB9KQoKICBhd2FpdCB1c2VyLmFkZEdyb3VwKGdyb3VwSWQsIGJvdElkKQogIGF3YWl0IGJvdC5zZW5kTWVzc2FnZShncm91cElkLCB7IHRleHQ6IGAhWzpQZXJzb25dKCR7dXNlci50b2tlbi5vd25lcl9pZH0pLCB5b3VyIHZvaWNlTWFpbCBpcyBtb25pdG9yZWQhXG5JZiB5b3Ugd2FudCBtZSB0byAqKnN0b3AgbW9uaXRvcioqIHlvdXIgdm9pY2VtYWlsLCBwbGVhc2UgcmVwbHkgIiFbOlBlcnNvbl0oJHtib3RJZH0pIHVubW9uaXRvciJgIH0pCgogIHJldHVybiByZXN1bHQoCiAgICAnWW91IGhhdmUgYXV0aG9yaXplZCB0aGUgYm90IHRvIGFjY2VzcyB5b3VyIFJpbmdDZW50cmFsIGRhdGEhIFBsZWFzZSBjbG9zZSB0aGlzIHBhZ2UgYW5kIGdldCBiYWNrIHRvIEdsaXAnCiAgKQp9Cg==</textarea>
<textarea class="saurus-file" data-file="../src/lamda/lib/user-webhook.js" data-mode="javascript">LyoqCiAqIHVzZXIgb2F1dGggYnkgdHlsZXIKICovCgppbXBvcnQge3Jlc3VsdCwgc3Vic2NyaWJlSW50ZXJ2YWwsIHNob3VsZFN5bmNWb2ljZU1haWx9IGZyb20gJy4vY29tbW9uJwppbXBvcnQge3N0b3JlfSBmcm9tICcuL3N0b3JlJwppbXBvcnQgXyBmcm9tICdsb2Rhc2gnCgpleHBvcnQgZGVmYXVsdCBhc3luYyAoZXZlbnQpID0+IHsKICBsZXQgbWVzc2FnZSA9IGV2ZW50LmJvZHkKICBsZXQgbmV3TWFpbENvdW50ID0gc2hvdWxkU3luY1ZvaWNlTWFpbChldmVudCkKICBsZXQgaXNSZW5ld0V2ZW50ID0gXy5nZXQobWVzc2FnZSwgJ2V2ZW50JykgPT09IHN1YnNjcmliZUludGVydmFsKCkKICBpZiAobmV3TWFpbENvdW50IHx8IGlzUmVuZXdFdmVudCkgewogICAgY29uc3QgdXNlcklkID0gKG1lc3NhZ2UuYm9keS5leHRlbnNpb25JZCB8fCBtZXNzYWdlLm93bmVySWQpLnRvU3RyaW5nKCkKICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBzdG9yZS5nZXRVc2VyKHVzZXJJZCkKCiAgICAvLyBnZXQgcmVtaW5kZXIgZXZlbnQsIGRvIHRva2VuIHJlbmV3IGFuZCBzdWJzY3JpYmUgcmVuZXcKICAgIGlmICh1c2VyICYmIGlzUmVuZXdFdmVudCkgewogICAgICBhd2FpdCB1c2VyLnJlbmV3V2ViSG9va3MoKQogICAgICBhd2FpdCB1c2VyLnJlZnJlc2goKQogICAgfQoKICAgIC8vIGdldCBuZXcgdm9pY2VtYWlsLCBwcm9jZXNzIHRoZSBlbWFpbCBhbmQgc2VuZCB0byBjaGF0IGdyb3VwCiAgICAvLyB0b2RvOiBjb21tZW50IG91dCBsaW5lMzMtMzUsIHVuY29tbWVudCBsaW5lNjctNzUKICAgIC8vIHRvZG86IHJlcGxhY2UgbGluZTMzLTM1LCB1c2UgeW91IG93biBwcm9jZXNzIGZ1bmN0aW9uLCBzZW5kIHNvbWUgY3VzdG9tIHJlcG9uc2UgYWJvdXQgbmV3IHZvaWNlIG1haWwKICAgIGVsc2UgaWYgKHVzZXIpIHsKICAgICAgYXdhaXQgdXNlci5wcm9jZXNzVm9pY2VNYWlsKG5ld01haWxDb3VudCkKICAgIH0KCiAgICAvLyByZXBsYWNlIGxpbmUzNC0zNiB3aXRoIHRoaXMgc2VjdGlvbiwgd2hpY2ggd2lsbCBvbmx5IHRlbGwgY2hhdCBncm91cCBob3cgbWFueSBuZXcgdm9pY2VtYWlsIHdlIGdldAogICAgLy8gZWxzZSBpZiAodXNlcikgewogICAgLy8gICBmb3IgKGNvbnN0IGdyb3VwSWQgb2YgT2JqZWN0LmtleXModXNlci5ncm91cHMpKSB7CiAgICAvLyAgICAgY29uc3QgYm90SWQgPSB1c2VyLmdyb3Vwc1tncm91cElkXQogICAgLy8gICAgIGNvbnN0IGJvdCA9IGF3YWl0IHN0b3JlLmdldEJvdChib3RJZCkKICAgIC8vICAgICBhd2FpdCBib3Quc2VuZE1lc3NhZ2UoCiAgICAvLyAgICAgICBncm91cElkLAogICAgLy8gICAgICAgeyB0ZXh0OiBgIVs6UGVyc29uXSgke3VzZXJJZH0pLCB5b3UgZ290ICR7bmV3TWFpbENvdW50fSBuZXcgdm9pY2VNYWlsISBgfQogICAgLy8gICAgICkKICAgIC8vICAgfQogICAgLy8gfQoKICB9CiAgcmV0dXJuIHJlc3VsdCgnV2ViSG9vayBnb3QnLCAyMDAsIHsKICAgIGhlYWRlcnM6IHsKICAgICAgJ3ZhbGlkYXRpb24tdG9rZW4nOiBldmVudC5oZWFkZXJzWyd2YWxpZGF0aW9uLXRva2VuJ10gfHwgZXZlbnQuaGVhZGVyc1snVmFsaWRhdGlvbi1Ub2tlbiddCiAgICB9CiAgfSkKfQo=</textarea>
<textarea class="saurus-file" data-file="../src/lamda/lib/voicemail-process.js" data-mode="javascript">LyoqCiAqIHJlYWQgdm9pY2VtYWlsIGFuZCBwcm9jZXNzIGl0CiAqLwoKaW1wb3J0IF8gZnJvbSAnbG9kYXNoJwppbXBvcnQge3N0b3JlfSBmcm9tICcuL3N0b3JlJwppbXBvcnQge2xvZ30gZnJvbSAnLi9jb21tb24nCmltcG9ydCBjcnlwdG8gZnJvbSAnY3J5cHRvJwoKY29uc3QgewogIEdPT0dMRV9BUFBMSUNBVElPTl9DUkVERU5USUFMUwp9ID0gcHJvY2Vzcy5lbnYKCi8vZmFrZSB0cmFuc2NyaXB0IGZvciBkZW1vCmxldCBzcGVlY2gydGV4dCA9ICgpID0+IHsKICByZXR1cm4gJ1RoaXMgaXMgZmFrZSB0cmFuc2NyaXB0IHRleHQgcmVzdWx0IGZvciBkZW1vLCB5b3UgY291bGQgc2V0IEdPT0dMRV9BUFBMSUNBVElPTl9DUkVERU5USUFMUyBpbiAuZW52IHRvIHVzZSByZWFsIGdvb2dsZSBzZXJ2aWNlLicKfQoKLy9mYWtlIHRyYW5zY3JpcHQgZm9yIGRlbW8KbGV0IHRleHRBbmFseXNpcyA9ICgpID0+IHsKICByZXR1cm4gSlNPTi5wYXJzZSgneyJ0ZXh0IjoiVGhpcyBpcyBmYWtlIHRyYW5zY3JpcHQgdGV4dCByZXN1bHQgZm9yIGRlbW8sIHlvdSBjb3VsZCBzZXQgR09PR0xFX0FQUExJQ0FUSU9OX0NSRURFTlRJQUxTIGluIC5lbnYgdG8gdXNlIHJlYWwgZ29vZ2xlIHNlcnZpY2UuIiwic2VudGltZW50Ijp7Im1hZ25pdHVkZSI6MCwic2NvcmUiOjB9LCJzeW50YXgiOnsic2VudGVuY2VzIjpbeyJ0ZXh0Ijp7ImNvbnRlbnQiOiJ0aGlzIGlzIHVyZ2VudCBwbGVhc2UiLCJiZWdpbk9mZnNldCI6LTF9LCJzZW50aW1lbnQiOm51bGx9XSwidG9rZW5zIjpbeyJ0ZXh0Ijp7ImNvbnRlbnQiOiJ0aGlzIiwiYmVnaW5PZmZzZXQiOi0xfSwicGFydE9mU3BlZWNoIjp7InRhZyI6IkRFVCIsImFzcGVjdCI6IkFTUEVDVF9VTktOT1dOIiwiY2FzZSI6IkNBU0VfVU5LTk9XTiIsImZvcm0iOiJGT1JNX1VOS05PV04iLCJnZW5kZXIiOiJHRU5ERVJfVU5LTk9XTiIsIm1vb2QiOiJNT09EX1VOS05PV04iLCJudW1iZXIiOiJTSU5HVUxBUiIsInBlcnNvbiI6IlBFUlNPTl9VTktOT1dOIiwicHJvcGVyIjoiUFJPUEVSX1VOS05PV04iLCJyZWNpcHJvY2l0eSI6IlJFQ0lQUk9DSVRZX1VOS05PV04iLCJ0ZW5zZSI6IlRFTlNFX1VOS05PV04iLCJ2b2ljZSI6IlZPSUNFX1VOS05PV04ifSwiZGVwZW5kZW5jeUVkZ2UiOnsiaGVhZFRva2VuSW5kZXgiOjEsImxhYmVsIjoiTlNVQkoifSwibGVtbWEiOiJ0aGlzIn0seyJ0ZXh0Ijp7ImNvbnRlbnQiOiJpcyIsImJlZ2luT2Zmc2V0IjotMX0sInBhcnRPZlNwZWVjaCI6eyJ0YWciOiJWRVJCIiwiYXNwZWN0IjoiQVNQRUNUX1VOS05PV04iLCJjYXNlIjoiQ0FTRV9VTktOT1dOIiwiZm9ybSI6IkZPUk1fVU5LTk9XTiIsImdlbmRlciI6IkdFTkRFUl9VTktOT1dOIiwibW9vZCI6IklORElDQVRJVkUiLCJudW1iZXIiOiJTSU5HVUxBUiIsInBlcnNvbiI6IlRISVJEIiwicHJvcGVyIjoiUFJPUEVSX1VOS05PV04iLCJyZWNpcHJvY2l0eSI6IlJFQ0lQUk9DSVRZX1VOS05PV04iLCJ0ZW5zZSI6IlBSRVNFTlQiLCJ2b2ljZSI6IlZPSUNFX1VOS05PV04ifSwiZGVwZW5kZW5jeUVkZ2UiOnsiaGVhZFRva2VuSW5kZXgiOjEsImxhYmVsIjoiUk9PVCJ9LCJsZW1tYSI6ImJlIn0seyJ0ZXh0Ijp7ImNvbnRlbnQiOiJ1cmdlbnQiLCJiZWdpbk9mZnNldCI6LTF9LCJwYXJ0T2ZTcGVlY2giOnsidGFnIjoiQURKIiwiYXNwZWN0IjoiQVNQRUNUX1VOS05PV04iLCJjYXNlIjoiQ0FTRV9VTktOT1dOIiwiZm9ybSI6IkZPUk1fVU5LTk9XTiIsImdlbmRlciI6IkdFTkRFUl9VTktOT1dOIiwibW9vZCI6Ik1PT0RfVU5LTk9XTiIsIm51bWJlciI6Ik5VTUJFUl9VTktOT1dOIiwicGVyc29uIjoiUEVSU09OX1VOS05PV04iLCJwcm9wZXIiOiJQUk9QRVJfVU5LTk9XTiIsInJlY2lwcm9jaXR5IjoiUkVDSVBST0NJVFlfVU5LTk9XTiIsInRlbnNlIjoiVEVOU0VfVU5LTk9XTiIsInZvaWNlIjoiVk9JQ0VfVU5LTk9XTiJ9LCJkZXBlbmRlbmN5RWRnZSI6eyJoZWFkVG9rZW5JbmRleCI6MSwibGFiZWwiOiJBQ09NUCJ9LCJsZW1tYSI6InVyZ2VudCJ9LHsidGV4dCI6eyJjb250ZW50IjoicGxlYXNlIiwiYmVnaW5PZmZzZXQiOi0xfSwicGFydE9mU3BlZWNoIjp7InRhZyI6IlgiLCJhc3BlY3QiOiJBU1BFQ1RfVU5LTk9XTiIsImNhc2UiOiJDQVNFX1VOS05PV04iLCJmb3JtIjoiRk9STV9VTktOT1dOIiwiZ2VuZGVyIjoiR0VOREVSX1VOS05PV04iLCJtb29kIjoiTU9PRF9VTktOT1dOIiwibnVtYmVyIjoiTlVNQkVSX1VOS05PV04iLCJwZXJzb24iOiJQRVJTT05fVU5LTk9XTiIsInByb3BlciI6IlBST1BFUl9VTktOT1dOIiwicmVjaXByb2NpdHkiOiJSRUNJUFJPQ0lUWV9VTktOT1dOIiwidGVuc2UiOiJURU5TRV9VTktOT1dOIiwidm9pY2UiOiJWT0lDRV9VTktOT1dOIn0sImRlcGVuZGVuY3lFZGdlIjp7ImhlYWRUb2tlbkluZGV4IjoxLCJsYWJlbCI6IkRJU0NPVVJTRSJ9LCJsZW1tYSI6InBsZWFzZSJ9XSwibGFuZ3VhZ2UiOiJlbiJ9LCJlbnRpdHlTZW50aW1lbnRzIjpbXX0nKQp9CgovL2lmIHNldCBHT09HTEVfQVBQTElDQVRJT05fQ1JFREVOVElBTFMsIHVzZSBnb29nbGUgc2VydmljZQppZiAoR09PR0xFX0FQUExJQ0FUSU9OX0NSRURFTlRJQUxTKSB7CiAgc3BlZWNoMnRleHQgPSByZXF1aXJlKCdhdWRpby1hbmFseXNpcy1zZXJ2aWNlL2Rpc3QvdXJsMnRleHQnKS5zcGVlY2gydGV4dAogIHRleHRBbmFseXNpcyA9IHJlcXVpcmUoJ2F1ZGlvLWFuYWx5c2lzLXNlcnZpY2UvZGlzdC90ZXh0LWFuYWx5c2lzJykudGV4dEFuYWx5c2lzCn0gZWxzZSB7CiAgbG9nKCdubyBHT09HTEVfQVBQTElDQVRJT05fQ1JFREVOVElBTFMgaW4gLmVudiwgc28gdXNlIGZha2UgZGF0YSBmb3IgZGVtbycpCn0KCi8qKgogKiBwcm9jZXNzIHZvaWNlIG1haWwKICogQHBhcmFtIHtvYmplY3R9IG1haWwKICogQHBhcmFtIHtvYmplY3R9IHJjCiAqLwpleHBvcnQgYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc01haWwgKG1haWwsIGhlYWRlcnMpIHsKICBsZXQgdXJsID0gXy5nZXQobWFpbCwgJ2F0dGFjaG1lbnRzWzBdLnVyaScpCiAgaWYgKCF1cmwpIHsKICAgIHJldHVybiAnJwogIH0KICBsZXQgbWQ1ID0gY3J5cHRvLmNyZWF0ZUhhc2goJ21kNScpLnVwZGF0ZSh1cmwpLmRpZ2VzdCgnaGV4JykKICBsZXQgY2FjaGVkID0gYXdhaXQgc3RvcmUuZ2V0Q2FjaGUobWQ1KQogIGlmIChjYWNoZWQpIHsKICAgIGxvZygndXNlIGNhY2hlIGZvcicsIHVybCwgbWQ1KQogICAgcmV0dXJuIGNhY2hlZAogIH0KICBsZXQgdGV4dCA9IGF3YWl0IHNwZWVjaDJ0ZXh0KAogICAgdXJsLCBoZWFkZXJzCiAgKQogIGlmICghXy5pc1N0cmluZyh0ZXh0KSkgewogICAgcmV0dXJuICcnCiAgfQogIGxldCByZXN1bHQgPSBhd2FpdCB0ZXh0QW5hbHlzaXModGV4dCkKICBpZiAoIXJlc3VsdCB8fCAhcmVzdWx0LnRleHQpIHsKICAgIHJldHVybiAnJwogIH0KICBhd2FpdCBzdG9yZS5hZGRDYWNoZSh7CiAgICBpZDogbWQ1LAogICAgcmVzdWx0CiAgfSkKICByZXR1cm4gcmVzdWx0Cn0K</textarea>
</div>
</div><div class="saurus-overview"><ul></ul></div></div><div class="saurus-code"><div class="file-path"><span class="crumb-container"></span><i class="fa fa-fw fa-folder"></i></div><div class="saurus-editor"></div></div><div class="saurus-explorer"><div class="saurus-file-list"></div><div class="saurus-file-actions"><a href="https://github.com/ringcentral-tutorials/ringcentral-ai-bot" target="_blank" class="explorer-get-code"><i class="fa fa-lg fa-github-square"></i>View Code on GitHub</a><a href="https://github.com/ringcentral-tutorials/ringcentral-ai-bot/archive/master.zip" target="_blank" class="explorer-get-code"><i class="fa fa-lg icon-download"></i>Download Source Code</a></div></div></div></div><footer><div class="footer-content"><div class="footer-content-row layout-2-cols"><div class="footer-content-row-left"><div class="footer-logo"><a href="http://www.ringcentral.com"><span>Back to the main site</span></a></div></div><div class="footer-content-row-right"><ul class="footer-text-links"><li><a href="http://www.ringcentral.com/legal.html" target="_blank"><span>Legal</span></a></li><li><a href="http://www.ringcentral.com/security-statement.html" target="_blank"><span>Security Policy</span></a></li><li><a href="http://www.ringcentral.com/legal/privacy-policy.html" target="_blank"><span>Privacy Policy</span></a></li><li><a ng-href="https://devcommunity.ringcentral.com" target="_blank" href="https://devcommunity.ringcentral.com"><span>Community</span></a></li><li><a href="https://medium.com/ringcentral-developers" target="_blank"><span>Blog</span></a></li></ul></div></div><div class="footer-content-row footer-content-row-last layout-2-cols"><div class="footer-content-row-left"><span class="footer-copyright">Â© 1999-<span ng-bind="::main.nowObj|date:'yyyy'" class="footer-copyright-to ng-binding">2017</span> RingCentral, Inc. All rights reserved.</span></div><div class="footer-content-row-right"><div class="footer-image-links"><div class="footer-image-link footer-image-link-facebook"><a target="_blank" href="http://www.facebook.com/ringcentral"><i class="fa icon-facebook"></i></a></div><div class="footer-image-link footer-image-link-twitter"><a target="_blank" href="http://twitter.com/ringcentraldevs"><i class="fa icon-twitter"></i></a></div><div class="footer-image-link footer-image-link-google-plus"><a target="_blank" href="https://www.google.com/+ringcentral"><i class="fa icon-google_plus"></i></a></div><div class="footer-image-link footer-image-link-linkedin"><a target="_blank" href="http://www.linkedin.com/company/ringcentral"><i class="fa icon-linkedin"></i></a></div><div class="footer-image-link footer-image-link-youtube"><a target="_blank" href="http://www.youtube.com/ringcentral"><i class="fa icon-youtube"></i></a></div></div></div></div></div></footer></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script><script src="ace/ace.js"></script><script src="ace/theme-monokai.js"></script><script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script><script>window.tutorialName="Building a RingCentral AI Chatbot";</script><script src="viewsaurus.js"></script></body></html>